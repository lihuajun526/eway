<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>获取用户信息</title>
</head>
<body>
正在获取用户信息
</body>
<script type="text/javascript" src="/jquery/jquery-1.11.1.js"></script>
<script type="text/javascript" src="/js/config.js"></script>
<script type="text/javascript">
function getQueryString(name) { 
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
    var r = window.location.search.substr(1).match(reg); 
    if (r != null) return r[2]; return null; 
}
$(function(){
	var code = getQueryString("code");
	$.ajax({
        type: 'get',
        dataType: 'json',
        url: appName + "/weChat/isBand?code=" + code,
        success: function (data) {
            var result = data.data;
            if(result != null){
            	if(result.id != null){
            		//若该微信号一绑定平台账号则前往首页
                	window.location.href = "/index";
                }else{
                	sessionStorage.setItem("openid",result.openid);
                	sessionStorage.setItem("nickname",result.nickname);
                	//若未绑定则前往绑定页
                	window.location.href = appName + "/weChat/toBand.html";
                }
            }else{
            	alert("用户信息获取失败");
            }
        }
    });
})
</script>
</html>